<style>
    @page { size: A4; margin: 1cm; }

    body {
        font-family: Arial, sans-serif;
        color: #000;
        background: #fff;
        font-size: 1rem;
        margin: 0;
        padding: 0;
    }

    .carta { width: 100%; max-width: 21cm; margin: auto; }

    /* Header */
    .header {
        text-align: center;
        border-bottom: 2px solid #003366;
        margin-bottom: 0.3cm;
        padding-bottom: 0.1cm;
    }
    .header img { width: 15rem; }

    /* Empresa */
    .empresa-info {
        text-align: center;
        line-height: 1rem;
        font-size: 0.7rem;
    }
    .empresa-info strong { color: #003366; }
    .fila-empresa { display:flex; justify-content:center; gap:2.5cm; margin-top:0.1cm; }

    /* Cotización */
    .cotizacion {
        display:flex;
        justify-content:space-between;
        border: 1px solid #003366;
        padding:0.15cm 0.4cm;
        margin:0.3cm auto;
        font-weight:bold;
        border-radius:3px;
        background:#f1f4fa;
        width:95%;
    }
    .cotizacion div { flex:1; text-align:center; }

    /* Subtabla cliente */
    .subtabla {
        width:95%;
        margin:0.2cm auto;
        border:1px solid #003366;
        border-collapse:collapse;
        font-size:0.80rem;
        
    }
    .subtabla td { border:1px solid #003366; padding:0.2cm 0.3cm; }
    .subtabla i { font-size:0.80rem; }

    /* Tabla productos */
    table { width:95%; margin:0.2cm auto; border-collapse:collapse; font-size:0.80rem; }
    table th, table td { border:1px solid #000; padding:0.15cm; text-align:center; }
    table th { background:#003366; color:#fff; }

    /* Totales */
    .totales { width:95%; margin:0.2cm auto; font-size:0.80rem; border-collapse:collapse; }
    .totales td { border:1px solid #ddd; padding:2px 4px; }
    .totales tr:nth-child(1), .totales tr:nth-child(2) { background:#f9f9f9; font-weight:600; }
    .totales tr:nth-child(3) { background:#e7ecf4; font-weight:bold; }
    .totales td:first-child { text-align:left; }
    .totales td:last-child { text-align:right; }

    /* Observaciones */
    .observaciones {
        width:94%;
        margin:0.4cm auto;
        font-size:0.70rem;
        padding:0.3cm;
        border-left:3px solid #003366;
        background:#f9f9f9;
        border-radius:3px;
    }
    .observaciones p { margin:0.3cm 0; font-weight:600; }

    /* Servicio */
    .servicio {
        width:95%;
        margin:0.3cm auto;
        border:1px solid #003366;
        border-radius:4px;
        padding:0.35cm;
        background:#f7faff;
        font-size:0.78rem;
    }
    .servicio h3 { text-align:center; color:#003366; margin:0 0 0.2cm 0; font-size:0.78rem; }
    .servicio ul { margin:0.1cm 0 0.1cm 0.8cm; padding:0; }

    /* Footer */
    .footer { text-align:center; font-size:0.68rem; color:#003366; margin-top:0.3cm; font-weight:bold; }

    /* No imprimir */
    @media print { .no-print { display:none !important; } }
</style>

<div class="carta">

    <!-- HEADER -->
    <div class="header">
        <img src="https://res.cloudinary.com/dbn15ujjz/image/upload/v1760025100/logomixnow_bwe9nj.png" alt="Logo Mixnow">
    </div>

    <!-- EMPRESA -->
    <div class="empresa-info">
        <p><strong>MIX NOW HORMIGONES SPA</strong></p>
        <p>FABRICACIÓN DE ARTÍCULOS DE HORMIGÓN, CEMENTO Y MOVIMIENTO DE TIERRA</p>
        <div><strong>ARICA</strong></div>
        <div class="fila-empresa">
            <span><strong>RUT:</strong> 77.414.873-6</span>
            <span><strong>Oficina:</strong> ANÍBAL CELEDÓN 1234</span>
        </div>
        <p>E-mail: <a href="mailto:mixnowhormigones@gmail.com">mixnowhormigones@gmail.com</a></p>
    </div>

    <!-- COTIZACIÓN -->
    <div class="cotizacion">
        <div>COTIZACIÓN N° {{ cotizacion.numero_cotizacion }}</div>
        <div>{{ cotizacion.fecha|date:"d-m-Y" }}</div>
    </div>

    <!-- CLIENTE -->
    <table class="subtabla">
        <tr>
            <td><strong>Nombre:</strong> {{ cotizacion.cliente.cliente }}</td>
            <td rowspan="4" style="text-align:center;">
                <strong>MIX NOW HORMIGONES SPA</strong><br>
                RUT: 77.414.873-6<br>
                <a href="mailto:mixnowhormigones@gmail.com">mixnowhormigones@gmail.com</a><br>
                <strong>BANCO SANTANDER</strong><br>CTA. CTE: 00008414316-2
            </td>
        </tr>
        <tr><td><strong>Rut:</strong> {{ cotizacion.cliente.Rut }}</td></tr>
        {% if cotizacion.cliente.obra %}
        <tr><td><strong>Dirección/Obra:</strong> {{ cotizacion.cliente.obra }}</td></tr>
        {% endif %}
        <tr><td><strong>Celular:</strong> {{ cotizacion.cliente.telefono|default_if_none:"" }}</td></tr>
        <tr><td colspan="2"><i>Válido hasta: {{ cotizacion.valido_hasta }}</i> — <i>Emitido: {{ cotizacion.fecha|date:"d-m-Y" }}</i></td></tr>
    </table>

    <!-- PRODUCTOS -->
    <table>
        <tr>
            <th>Servicio o producto</th>
            <th>M3</th>
            <th>Precio por M3</th>
            <th>Subtotal</th>
            <th>IVA</th>
            <th>Total</th>
        </tr>
        {% for item in cotizacion.items.all %}
        <tr>
            <td>{{ item.descripcion }}</td>
            <td>{{ item.cantidad_m3 }}</td>
            <td>{{ item.precio_unitario|floatformat:0 }} {{ item.moneda }}</td>
            <td>{{ item.subtotal|floatformat:0 }}</td>
            <td>{{ item.iva|floatformat:0 }}</td>
            <td>{{ item.total|floatformat:0 }}</td>
        </tr>
        {% endfor %}
    </table>

    <!-- TOTALES -->
    <table class="totales">
        <tr><td>Subtotal general</td><td>{{ cotizacion.subtotal_general|floatformat:0 }} {{ items.0.get_moneda_display }}</td></tr>
        <tr><td>IVA TOTAL</td><td>{{ cotizacion.iva_total|floatformat:0 }} {{ items.0.get_moneda_display }}</td></tr>
        <tr><td>Total general</td><td>{{ cotizacion.total_general|floatformat:0 }} {{ items.0.get_moneda_display }}</td></tr>
    </table>

    <!-- OBSERVACIONES -->
    <div class="observaciones">
        <p> - "EL SERVICIO DEBE ESTAR PAGADO AL 100% PARA SU DESPACHO"</p>
        <p> - * MIX NOW HORMIGONES EQUIPOS: 2 PLANTAS DE HORMIGÓN MIX 70 Y MIX 100 (CALIBRADAS)
         — 8 CAMIONES MIXER, 6 BOMBAS DE HORMIGÓN.</p>
        <p> - VALENTINO VENEGAS — CEL: +56 977760047</p>
    </div>

    <!-- SERVICIO -->
    <div class="servicio">
        <h3>Información del Servicio</h3>
        <p><strong>Estimado Cliente(a):</strong></p>
        <p>Para confirmar el servicio se solicita el pago total.</p>
        <p><u>Medios de pago:</u> Efectivo o Transferencia.</p>
        <ul>
            <li>Incluye visita técnica confirmada.</li>
            <li>Tiempo de descarga: 2–4,5 m³ = 1h / 5–7 m³ = 1,5h aprox.</li>
            <li>No incluye arriendo de vibradora ni gestión de permisos.</li>
            <li>Cubicar obra y disponibilidad de camiones.</li>
            <li>No agregar agua al hormigón.</li>
        </ul>
    </div>

    <!-- FOOTER -->
    <div class="footer">MIXNOW.CL HORMIGONES SPA</div>

</div>

<!-- Botón PDF -->
<div class="no-print" style="text-align:center; margin-top:0.5cm;">
    <a href="{% url 'generar_pdf' cotizacion.id 'mixnow' %}" style="padding:0.4rem 1rem; background:#003366; color:#fff; text-decoration:none; border-radius:3px;">Descargar PDF</a>
</div>
